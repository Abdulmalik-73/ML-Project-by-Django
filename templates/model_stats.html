{% extends 'base.html' %}

{% block title %}Model Statistics - Haramaya{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <h2 class="mb-4"><i class="fas fa-chart-bar"></i> Model Statistics</h2>

            {% if model_loaded %}
            <!-- Model Performance Cards -->
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h6 class="card-title text-muted">R² Score</h6>
                            <p class="h3" style="color: #3498db;">{{ r2_score }}</p>
                            <small class="text-muted">Model Accuracy</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h6 class="card-title text-muted">MAE</h6>
                            <p class="h3" style="color: #e74c3c;">{{ mae }} ETB</p>
                            <small class="text-muted">Mean Absolute Error</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h6 class="card-title text-muted">RMSE</h6>
                            <p class="h3" style="color: #27ae60;">{{ rmse }} ETB</p>
                            <small class="text-muted">Root Mean Squared Error</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Info -->
            <div class="card mb-4">
                <div class="card-header" style="background-color: #ecf0f1;">
                    <h5 class="mb-0"><i class="fas fa-info-circle"></i> Model Information</h5>
                </div>
                <div class="card-body">
                    <p><strong>Algorithm:</strong> Random Forest Regressor</p>
                    <p><strong>Number of Trees:</strong> 100</p>
                    <p><strong>Max Depth:</strong> 10</p>
                    <p><strong>Training Samples:</strong> 44 (80% of dataset)</p>
                    <p><strong>Test Samples:</strong> 11 (20% of dataset)</p>
                </div>
            </div>

            <!-- Prediction Statistics -->
            <div class="card mb-4">
                <div class="card-header" style="background-color: #ecf0f1;">
                    <h5 class="mb-0"><i class="fas fa-history"></i> Prediction History</h5>
                </div>
                <div class="card-body">
                    <p><strong>Total Predictions Made:</strong> <span class="badge bg-primary">{{ total_predictions }}</span></p>
                    <p class="text-muted">Track all predictions made through the system in the admin panel.</p>
                </div>
            </div>

            <!-- Features Used -->
            <div class="card mb-4">
                <div class="card-header" style="background-color: #ecf0f1;">
                    <h5 class="mb-0"><i class="fas fa-list"></i> Features Used</h5>
                </div>
                <div class="card-body">
                    <ul>
                        <li>Number of Bedrooms</li>
                        <li>Number of Bathrooms</li>
                        <li>House Size (sqm)</li>
                        <li>Land Size (sqm)</li>
                        <li>Location (Encoded)</li>
                        <li>House Condition (Encoded)</li>
                        <li>Year Built</li>
                    </ul>
                </div>
            </div>

            <!-- Interpretation Guide -->
            <div class="card mb-4">
                <div class="card-header" style="background-color: #ecf0f1;">
                    <h5 class="mb-0"><i class="fas fa-book"></i> How to Interpret Results</h5>
                </div>
                <div class="card-body">
                    <h6>R² Score</h6>
                    <p>
                        Ranges from 0 to 1. Higher values indicate better fit.
                        <br>
                        <strong>{{ r2_score }}</strong> means the model explains {{ r2_score|floatformat:1 }}% of the variance in house prices.
                    </p>

                    <h6 class="mt-3">Mean Absolute Error (MAE)</h6>
                    <p>
                        Average absolute difference between predicted and actual prices.
                        <br>
                        On average, predictions are off by approximately <strong>{{ mae }}</strong> ETB.
                    </p>

                    <h6 class="mt-3">Root Mean Squared Error (RMSE)</h6>
                    <p>
                        Similar to MAE but penalizes larger errors more heavily.
                        <br>
                        Useful for understanding the typical magnitude of prediction errors.
                    </p>
                </div>
            </div>

            {% else %}
            <div class="alert alert-warning" role="alert">
                <i class="fas fa-exclamation-triangle"></i> 
                <strong>Model Not Found!</strong> 
                <p>Please train the model first by running:</p>
                <code>python train_model.py</code>
            </div>
            {% endif %}

            <!-- Back Button -->
            <div class="text-center">
                <a href="{% url 'core:home' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Home
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
